<!--					****************		FORMULARIO DE ALTA/MODIFICACION	DE JOBS		**************** 						-->
<!--	El modelo de formulario usado para esta parte de la página es el Reactive Form, es decir, los controles y validaciones se 
		establecen al crear la relacion con el propio campo desde el componente. Adicionalmente método de generacion de formularios 
		nos permite crear campos de	forma dinamica, como por ejemplo en el caso de los pasos de los jobs.							-->

<div id="areaAlta">
	<br>
	<form id="altaJobsForm" name="altaJobsForm" [formGroup]="altaJobsForm" (ngSubmit)="onSubmit()" novalidate>
		<fieldset id="fieldAlta" class="the-fieldset well">
			<legend class="the-legend text-muted">
				Formulario de alta de Jobs
			</legend>
			<div class="row form-group form-group-sm">			
				<!-- JOBNAME -->
				<div class="col-sm-4">
					<label for="des_nombrjob">JobName</label> 
					<input type="text" class="form-control" id="des_nombrjob" name="des_nombrjob" formControlName="des_nombrjob">
					 
					<small class="text-danger" 
						*ngIf="altaJobsForm.get('des_nombrjob').invalid && (altaJobsForm.get('des_nombrjob').dirty || altaJobsForm.get('des_nombrjob').touched)">
						Campo obligatorio de al menos 8 caracteres
					</small>
				</div>
				
				<!-- NOMBRE DOCUMENTO-->
				<div class="col-sm-4">
					<label for="des_refdocjb">Nombre del Documento</label> 
					<input type="text" class="form-control" id="des_refdocjb" name="des_refdocjb" formControlName="des_refdocjb">
				
					<small class="text-danger" 
						*ngIf="altaJobsForm.get('des_refdocjb').invalid && (altaJobsForm.get('des_refdocjb').dirty || altaJobsForm.get('des_refdocjb').touched)">
						Campo obligatorio de al menos 8 caracteres
					</small>
				</div>
				
				<!-- COD. APLICACION (UUAA) -->
				<div class="col-sm-3">
					<label for="cod_aplicaci">Cod.Aplicación - UUAA</label> 
					<input type="text" class="form-control" id="cod_aplicaci" name="cod_aplicaci" maxlength="4" formControlName="cod_aplicaci">
					 
					<small class="text-danger" 
						*ngIf="altaJobsForm.get('cod_aplicaci').invalid && (altaJobsForm.get('cod_aplicaci').dirty || altaJobsForm.get('cod_aplicaci').touched)">
						Campo obligatorio de 4 caracteres
					</small>
				</div>
			</div>
			<div class="row form-group form-group-sm">
				<!-- GRUPO DE SOPORTE -->
				<div class="col-sm-4">
					<label for="des_gsoporte">Grupo de Soporte</label>
					<select class="form-control" id="des_gsoporte" name="des_gsoporte" formControlName="des_gsoporte">  
						<option *ngFor="let grupo of grupo_soporte" [value]="grupo">{{grupo}}</option>	
					</select>
					<small class="text-danger" 
						*ngIf="altaJobsForm.get('des_gsoporte').invalid && (altaJobsForm.get('des_gsoporte').dirty || altaJobsForm.get('des_gsoporte').touched)">
						Seleccione una opción válida
					</small>
				</div>
				
				<!-- MAQUINA DE ORIGEN -->
				<div class="col-sm-4">
					<label for="des_maqori">Máquina origen</label> 
					<input type="text" class="form-control" id="des_maqori" name="des_maqori" formControlName="des_maqori">
				</div>
				
				<!-- LIBRERIA DE ORIGEN -->
				<div class="col-sm-4">
					<label for="des_libreori">Librería origen</label> 
					<input type="text" class="form-control" id="des_libreori" name="des_libreori" formControlName="des_libreori">
				</div>
			</div>
			
			<div class="row form-group form-group-sm">
				<!-- DESCRIPCION -->
				<div class="col-sm-12">
					<label for="des_desjobpl">Descripción</label>
					<textarea rows="5" class="form-control" id="des_desjobpl" name="des_desjobpl" formControlName="des_desjobpl">
 					</textarea>
				</div>
			</div>
				
			<div class="row form-group form-group-sm">
				<!-- PERIODICIDAD -->
				<div class="col-sm-12">
					<label for="des_periojob">Reglas de Planificación/Periodicidad</label>
					<textarea rows="2" class="form-control" id="des_periojob" name="des_periojob" formControlName="des_periojob">
 					</textarea>
				</div>
			</div>
			
			<div class="row form-group form-group-sm">
				<!-- ESTRUCTURA -->
				<div class="col-sm-4">
					<label for="des_estrupl">Estructura</label> 
					<input type="text" class="form-control" id="des_estrupl" name="des_estrupl" formControlName="des_estrupl">
				</div>
				
				<!-- MAQUINA DE EJECUCION -->
				<div class="col-sm-4">
					<label for="des_maqeje">Máquina de ejecución</label> 
					<input type="text" class="form-control" id="des_maqeje" name="des_maqeje" formControlName="des_maqeje">
				</div>
			</div>
			
			<label>Descripción de pasos:</label>
			<br>
			<!-- TABLA DE LOS PASOS DE ENTRADA/SALIDA DE FICHEROS Y BBDD -->
			<div formArrayName="pasos1">			
				<table id="jobsDescPasos" class="table table-striped table-bordered">
					<thead>
						<tr>
							<th class="col-sm-1 celda-vacia"></th>
							<th colspan="2" class="col-sm-5">FICHEROS</th>
							<th colspan="2" class="col-sm-5">BASE DE DATOS</th>
							<th class="col-sm-1 celda-vacia"></th>
						</tr>
						<tr>
							<th>PASOS</th>
							<th>ENTRADA</th>
							<th>SALIDA</th>
							<th>ENTIDADES</th>
							<th>TIPO DE ACCESO</th>
							<th>ACCIONES</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let paso1 of pasos1.controls; let i=index" [formGroupName]="i">
							<td>
								<input class="form-control" formControlName="des_paso">
	<!-- 							<small *ngIf="!altaJobsForm.get('pasos1').valid" class="text-danger"> -->
	<!-- 								Obligatrio -->
	<!-- 							</small> -->
							</td>						
							<td>
								<input class="form-control" formControlName="des_fichentr">
							</td>						
							<td>
								<input class="form-control" formControlName="des_fichsali">
							</td>						
							<td>
								<input class="form-control" formControlName="des_entibd">
							</td>						
							<td>
								<input class="form-control" formControlName="des_accesbd">
							</td>						
							<td>
	<!-- 							<span class="glyphicon glyphicon-remove" *ngIf="altaJobsForm.get('pasos1').length > 1" (click)="removePaso(i)"></span> -->
								<span class="glyphicon glyphicon-remove" *ngIf="pasos1.length > 1" (click)="removePaso1(i)"></span>
							</td>						
						</tr>
						<tr class="margin-20">
							<td colspan = "6">
								<a (click)="addPaso1()" style="cursor: pointer;"> 
									Crear nuevo paso + 
								</a>
							</td>
						</tr>
					</tbody>
				</table>			
			</div>
			
			<!-- TABLA DE LOS PASOS PARA LAS NORMAS DE REARRANQUE -->
			<div formArrayName="pasos2">
				<table id="jobsRearranques"
					class="table table-striped table-bordered">
					<thead>
						<tr>
							<th class="col-sm-1">PASO</th>
							<th class="col-sm-3">PREDECESORES</th>
							<th class="col-sm-3">SUCESORES</th>
							<th class="col-sm-4">NORMAS DE REARRANQUE</th>
							<th class="col-sm-1">ACCIONES</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let paso2 of pasos2.controls; let j=index" [formGroupName]="j">
							<td>
								<input class="form-control" formControlName="des_paso">
							</td>						
							<td>
								<input class="form-control" formControlName="des_predece">
							</td>						
							<td>
								<input class="form-control" formControlName="des_sucesor">
							</td>						
							<td>
								<input class="form-control" formControlName="des_rearra">
							</td>						
							<td>
								<span class="glyphicon glyphicon-remove" *ngIf="pasos2.length > 1" (click)="removePaso2(j)"></span>
							</td>						
						</tr>
						<tr class="margin-20">
							<td colspan = "5">
								<a (click)="addPaso2()" style="cursor: pointer;"> 
									Crear nuevo paso + 
								</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<!-- TABLA DE LOS PASOS DE INCOMPATIBILIDADES -->
			<div formArrayName="pasos3">
				<table id="jobsIncompatibilidades"
					class="table table-striped table-bordered">
					<thead>
						<tr>
							<th class="col-sm-1">PASO</th>
							<th class="col-sm-7">INCOMPATIBILIDADES</th>
							<th class="col-sm-3">CRITICIDAD</th>
							<th class="col-sm-1">ACCIONES</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let paso3 of pasos3.controls; let k=index" [formGroupName]="k">
							<td>
								<input class="form-control" formControlName="des_paso">
							</td>						
							<td>
								<input class="form-control" formControlName="des_incomjob">
							</td>						
							<td>
								<input class="form-control" formControlName="des_critinco">
							</td>						
							<td>
								<span class="glyphicon glyphicon-remove" *ngIf="pasos3.length > 1" (click)="removePaso3(k)"></span>
							</td>						
						</tr>
						<tr class="margin-20">
							<td colspan = "4">
								<a (click)="addPaso3()" style="cursor: pointer;"> 
									Crear nuevo paso + 
								</a>
							</td>
						</tr>
					</tbody>
				</table>			
			</div>
			
			<!-- BOTONERA DEL FORMULARIO -->
			<div class="row form-group form-group-sm">
				<div class="col-sm-3">
					<button type="button" class="pull-left btn btn-primary" (click)="limpiar()">Limpiar</button>
				</div>
				<div class="col-sm-offset-6 col-sm-3">
					<button id="frmAltaBtnOK" type="submit" class="pull-right btn btn-success">Aceptar</button>
				</div>
			</div>
			
			<!-- PRUEBAS -->
			<div class="row form-group form-group-sm">
				<div class="col-sm-3">
					<button type="button" class="pull-left btn btn-primary" (click)="prueba()">Informar</button>
				</div>
			</div>
		</fieldset>
<!-- 		QUITAR TODO: -->
		<div class="margin-20">
          <div>altaJobsForm details:</div>
          <pre>Is altaJobsForm valid?: <br>{{altaJobsForm.valid | json}}</pre>
          <pre>altaJobsForm value: <br>{{altaJobsForm.value | json}}</pre>
        </div>
	</form>
</div>