<!--					****************		FORMULARIO DE ALTA/MODIFICACION	DE JOBS		**************** 						-->
<!--	El modelo de formulario usado para esta parte de la página es el Reactive Form, es decir, los controles y validaciones se 
		establecen al crear la relacion con el propio campo desde el componente. Adicionalmente método de generacion de formularios 
		nos permite crear campos de	forma dinamica, como por ejemplo en el caso de los pasos de los jobs.							-->

<div id="areaAltaCadena" class="container">
	<br>
	<form id="altaCadenasForm" name="altaCadenasForm" [formGroup]="altaCadenasForm" (ngSubmit)="onSubmit()" novalidate>
		<fieldset id="fieldAlta" class="the-fieldset well">
			<legend class="the-legend text-muted">
				Formulario de alta de Cadenas
			</legend>
			
			<fieldset>
				<legend>
					Nombre y descripcion de la cadena:
				</legend>
				<div class="row form-group form-group-sm">			
					<!-- DOCUMENTO ASOCIADO -->
					<div class="col-sm-4">
						<label for="des_refdocum">Documento Asociado</label> 
						<input type="text" class="form-control" id="des_refdocum" name="des_refdocum" formControlName="des_refdocum">
						 
						<small class="text-danger" 
							*ngIf="altaCadenasForm.get('des_refdocum').invalid && (altaCadenasForm.get('des_refdocum').dirty || altaCadenasForm.get('des_refdocum').touched)">
							Campo obligatorio de al menos 8 caracteres
						</small>
					</div>
					
					<!-- CADENA -->
					<div class="col-sm-4">
						<label for="des_cadenapl">Cadena</label> 
						<input type="text" class="form-control" id="des_cadenapl" name="des_cadenapl" formControlName="des_cadenapl">
					
						<small class="text-danger" 
							*ngIf="altaCadenasForm.get('des_cadenapl').invalid && (altaCadenasForm.get('des_cadenapl').dirty || altaCadenasForm.get('des_cadenapl').touched)">
							Campo obligatorio de al menos 8 caracteres
						</small>
					</div>
					
					<!-- COD. APLICACION (UUAA) -->
					<div class="col-sm-4">
						<label for="cod_aplicaci">Cod.Aplicación - UUAA</label> 
						<input type="text" class="form-control" id="cod_aplicaci" name="cod_aplicaci" maxlength="4" formControlName="cod_aplicaci">
						 
						<small class="text-danger" 
							*ngIf="altaCadenasForm.get('cod_aplicaci').invalid && (altaCadenasForm.get('cod_aplicaci').dirty || altaCadenasForm.get('cod_aplicaci').touched)">
							Campo obligatorio de 4 caracteres
						</small>
					</div>
				</div>
				
				<div class="row form-group form-group-sm">
					<!-- AUTOR -->
					<div class="col-sm-4">
						<label for="des_autor">Autor</label> 
						<input type="text" class="form-control" id="des_autor" name="des_autor" formControlName="des_autor">
					</div>
					
					<!-- FECHA DE MODIFICACION -->
					<div class="col-sm-offset-4 col-sm-4">
						<label for="fec_modifica">Fecha de Modificación</label> 
						<input type="date" class="form-control" id="fec_modifica" name="fec_modifica" formControlName="fec_modifica">
					</div>
				</div>
				
				<div class="row form-group form-group-sm">
					<!-- DESCRIPCION -->
					<div class="col-sm-12">
						<label for="des_descaden">Descripción</label>
						<textarea rows="5" class="form-control" id="des_descaden" name="des_descaden" formControlName="des_descaden">
 					</textarea>
					</div>
				</div>
			</fieldset>
			
			<br>
			<fieldset>
				<legend>
					Instrucciones de Ejecución:
				</legend>
				<div class="row form-group form-group-sm">
					<!-- EQUIPO -->
					<div class="col-sm-3">
						<label for="des_equipocd">Equipo</label> 
						<input type="text" class="form-control" id="des_equipocd" name="des_equipocd" formControlName="des_equipocd">
					</div>
					
					<!-- PERIODICIDAD -->
					<div class="col-sm-3">
						<label for="xti_periocdn">Periodicidad</label> 
						<input type="text" class="form-control" id="xti_periocdn" name="xti_periocdn" formControlName="xti_periocdn">
					</div>
					
					<!-- DIA EJECUCION -->
					<div class="col-sm-3">
						<label for="des_diaejecu">Día de ejecución</label> 
						<input type="text" class="form-control" id="des_diaejecu" name="des_diaejecu" formControlName="des_diaejecu">
					</div>
					
					<!-- HORARIO -->
					<div class="col-sm-3">
						<label for="des_horaejec">Horario</label> 
						<input type="text" class="form-control" id="des_horaejec" name="des_horaejec" formControlName="des_horaejec">
					</div>
				</div>
				
				<div class="row form-group form-group-sm">
					<!-- CRITICIDAD -->
					<div class="col-sm-4">
						<label for="xti_critical">Criticidad</label> 
						<input type="text" class="form-control" id="xti_critical" name="xti_critical" formControlName="xti_critical">
					</div>
					
					<!-- REARRANQUES -->
					<div class="col-sm-4">
						<label for="des_rearran">Rearranques</label> 
						<input type="text" class="form-control" id="des_rearran" name="des_rearran" formControlName="des_rearran">
					</div>
					
					<!-- INTERRELACION ONLINE -->
					<div class="col-sm-4">
						<label for="des_interrel">Interrelación Online</label> 
						<input type="text" class="form-control" id="des_interrel" name="des_interrel" formControlName="des_interrel">
					</div>
				</div>
			</fieldset>
			
			<br>
			<fieldset>
				<legend>
					Relación de scripts de la cadena y de sus dependencias:
				</legend>
				<!-- TABLA DE RELACIONES DE SCRIPTS Y SUS DEPENDENCIAS -->
				<div formArrayName="relaciones">			
					<table id="cdnRelaciones" class="table table-striped table-bordered">
						<thead>
							<tr>
								<th class="col-sm-3 celda-vacia"></th>
								<th colspan="2" class="col-sm-4">PREDECESORES</th>
								<th colspan="2" class="col-sm-4">SUCESORES</th>
								<th class="col-sm-1 celda-vacia"></th>
							</tr>
							<tr>
								<th>NOMBRE SCRIPT</th>
								<th>SCRIPT</th>
								<th>CADENA</th>
								<th>SCRIPT</th>
								<th>CADENA</th>
								<th>ACCIONES</th>
							</tr>
						</thead>
						<tbody>
							<tr *ngFor="let relacion of relaciones.controls; let i=index" [formGroupName]="i">
								<td>
									<input class="form-control" formControlName="des_scriptjb">
								</td>						
								<td>
									<input class="form-control" formControlName="des_scriptpr">
								</td>						
								<td>
									<input class="form-control" formControlName="des_cadenapr">
								</td>						
								<td>
									<input class="form-control" formControlName="des_scriptsu">
								</td>						
								<td>
									<input class="form-control" formControlName="des_cadenasu">
								</td>						
								<td>
									<span class="glyphicon glyphicon-remove" *ngIf="relaciones.length > 1" (click)="removeRelacion(i)"></span>
								</td>						
							</tr>
							<tr class="margin-20">
								<td colspan = "6">
									<a (click)="addRelacion()" style="cursor: pointer;"> 
										Crear nueva relación + 
									</a>
								</td>
							</tr>
						</tbody>
					</table>			
				</div>
			</fieldset>
			
			<br>
			<fieldset>
				<legend>
					Incompatibilidades:
				</legend>
				<div class="row form-group form-group-sm">
					<!-- INCOMPATIBILIDADES -->
					<div class="col-sm-12">
						<textarea rows="3" class="form-control" id="des_incompat" name="des_incompat" formControlName="des_incompat">
 					</textarea>
					</div>
				</div>
			</fieldset>
			
			<!-- BOTONERA DEL FORMULARIO -->
			<div class="row form-group form-group-sm">
				<div class="col-sm-3">
					<button type="button" class="pull-left btn btn-primary" (click)="limpiar()">Limpiar</button>
				</div>
				<div class="col-sm-offset-6 col-sm-3">
					<button id="frmAltaBtnOK" type="submit" class="pull-right btn btn-success">Aceptar</button>
				</div>
			</div>
		</fieldset>
<!-- 		QUITAR TODO: -->
		<div class="margin-20">
          <div>altaCadenasForm details:</div>
          <pre>Is altaCadenasForm valid?: <br>{{altaCadenasForm.valid | json}}</pre>
          <pre>altaCadenasForm value: <br>{{altaCadenasForm.value | json}}</pre>
        </div>
	</form>
</div>